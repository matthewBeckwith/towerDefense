<!DOCTYPE HTML>
<html>
<head>
  <title>Tower Defense</title>

  <style>
    #gameboard{
      position: absolute;
      top:0;
      left:0;
      border:1px solid black;
    }
  </style>

  <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
</head>
<body>

  <canvas id="gameboard" height=500 width=500></canvas>

  <script>
    var canvas = document.getElementById('gameboard');
    var ctx = canvas.getContext('2d');

    var TOWERSPACE_COLOR = "#42f44e";
    var EMPTYSPACE_COLOR = "#000";
    var PATHSPACE_COLOR = "#b29c52";
    var FPS = 1000/30;

    var boxsize = 25;

    var level = createLevel();

    var timer = window.setInterval(draw,FPS);

    function draw(){
      ctx.clearRect(0,0,canvas.height,canvas.width);

      drawLevel(level);
    }

    function drawLevel(level){
      for(row in level){
        for(col in level[row]){
          if(level[row][col] == 2){
            drawTowerSpace(col * boxsize, row * boxsize);
          }
          if(level[row][col] == 1){
            drawPathSpace(col * boxsize, row * boxsize);
          }
          if(level[row][col] == 0){
            drawEmptySpace(col * boxsize, row * boxsize);
          }
        }
      }
    }

    function createLevel(){
      var newLevel = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
      ];

      var lastPos;

      for(var i = 0; i < newLevel.length; i++){
        var temp = Math.floor(Math.random() * (newLevel.length - 1));

        if(temp > 0){
          if(i == 0){
            newLevel[i][temp] = 1;
            lastPos = temp;
          }else{
            if(i % 2 == 0){
              newLevel[i][lastPos] = 1;
            }else{
              for(var j = 0; j < newLevel[i].length; j++){
                if(j >= temp && j <= lastPos){
                  newLevel[i][j] = 1;
                }else if(j <= temp && j >= lastPos){
                  newLevel[i][j] = 1;
                }
              }
              lastPos = temp;
            }
          }
        }else{
          console.log("Had to rewind");
          i--;
          continue;
        }
      }


      return newLevel;
    }

    function drawTowerSpace(x,y){
      ctx.fillStyle = TOWERSPACE_COLOR;
      ctx.fillRect(x,y,boxsize,boxsize);
    }

    function drawPathSpace(x,y){
      ctx.fillStyle = PATHSPACE_COLOR;
      ctx.fillRect(x,y,boxsize,boxsize);
    }

    function drawEmptySpace(x,y){
      ctx.fillStyle = EMPTYSPACE_COLOR;
      ctx.fillRect(x,y,boxsize,boxsize);
    }
  </script>
</body>
</html>
